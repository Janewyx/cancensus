<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Making maps with cancensus • cancensus</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">cancensus</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/cancensus.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Making_maps_with_cancensus.html">Making maps with cancensus</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mountainMath/cancensus">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Making maps with cancensus</h1>
                        <h4 class="author">Dmitry Shkolnik</h4>
            
          </div>

    
    
<div class="contents">
<div id="spatial-data-in-cancensus" class="section level1">
<h1 class="hasAnchor">
<a href="#spatial-data-in-cancensus" class="anchor"></a>Spatial data in cancensus</h1>
<p><strong>cancensus</strong> can retrieve spatial data either on its own or packaged together with Census data.</p>
<p>You can specify whether you want data returned in an <code>sf</code>-class data frame or as a <code>sp</code>-class SpatialPolygonsDataFrame object. There are advantages to each spatial format. The <code>sf</code> spatial framework is under development as the new principal spatial library for R and takes advantage of the <a href="https://en.wikipedia.org/wiki/Simple_Features">Simple Features</a> standard.</p>
<p>On the other hand, <code>sp</code> has been around for a long time with development starting in the early 2000s and, as a result, it is a robust and well-maintained package with a large ecosystem of specialized packages that rely on it. First released in October 2016, <code>sf</code> is a package still under development can be buggy and prone to breaking.</p>
<p><strong>cancensus</strong> retrieves Census geographic data as GeoJSON objects and then converts them into either <code>sp</code> or <code>sf</code> objects depending on the <code>geo_format</code> parameter input. The examples in this vignette assume <code>sf</code> class geography.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(cancensus)
<span class="kw">library</span>(sf)
<span class="co"># retrieve sf dataframe</span>
toronto &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_census.html">get_census</a></span>(<span class="dt">dataset=</span><span class="st">'CA16'</span>, <span class="dt">regions=</span><span class="kw">list</span>(<span class="dt">CMA=</span><span class="st">"35535"</span>),
                         <span class="dt">vectors=</span><span class="st">"v_CA16_2397"</span>, <span class="dt">level=</span><span class="st">'CSD'</span>, <span class="dt">quiet =</span> <span class="ot">TRUE</span>, 
                         <span class="dt">geo_format =</span> <span class="st">'sf'</span>, <span class="dt">labels =</span> <span class="st">'short'</span>)</code></pre></div>
</div>
<div id="maps-with-base-r-graphics" class="section level1">
<h1 class="hasAnchor">
<a href="#maps-with-base-r-graphics" class="anchor"></a>Maps with base R graphics</h1>
<p>THe <code>sf</code> package provides a wrapper around the base R <code><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot()</a></code> function and largely works the same way with most of the same custom graphical parameters. One key thing about <code>sf.plot()</code> is that it will plot every column of a sf data frame separately unless you specify a particular colummn. In this case, the household income variable we selected is stored in the <code>v_CA16_2397</code> column. Plotting it is easy.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(toronto[<span class="dv">14</span>], <span class="dt">main =</span> <span class="st">"Toronto Household Income by CSD"</span>)</code></pre></div>
<p>You can specify titles, colour palettes, breaks, background colour, lines, borders, transparency, graticles, and much more by taking advantage of the available parameters. You can also combine layers of graphics objects made with <code><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot()</a></code> by running different plots and adding the <code>add = TRUE</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(toronto[<span class="dv">14</span>], <span class="dt">col =</span> <span class="ot">NA</span>, <span class="dt">main =</span> <span class="st">"Toronto CSDs with Median HH Income &gt; 100,000"</span>, <span class="dt">lty =</span> <span class="dv">3</span>)
<span class="kw"><a href="http://www.rdocumentation.org/packages/sf/topics/plot">plot</a></span>(toronto[toronto$v_CA16_2397 &gt;<span class="st"> </span><span class="dv">100000</span>,<span class="dv">14</span>], <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="maps-with-ggplot2" class="section level1">
<h1 class="hasAnchor">
<a href="#maps-with-ggplot2" class="anchor"></a>Maps with ggplot2</h1>
<p>Plotting <code>sf</code> objects with <code>ggplot2</code> is very straightforward with the built-in <code>geom_sf</code> layer. However, as of writing, this new geom is only available in the recent dev versions of the <code>ggplot2</code> package. The next scheduled CRAN release of <code>ggplot2</code> will fully incorporate <code>geom_sf</code>. It’s easy to install the dev version from Github:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("devtools")</span>
devtools::<span class="kw">install_github</span>(<span class="st">"tidyverse/ggplot2"</span>)</code></pre></div>
<p><code>ggplot2</code> supports all types of simple features and can automatically read and align CRS across multiple layers, can automatically adjust aspect ratio, and will automatically draw a graticule for your map. The advantage of using <code>ggplot2</code> for static maps is the customization and flexibility offered by the <code>ggplot2</code> layer and geom system.</p>
<p>An example of a basic map.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(toronto) +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">fill =</span> v_CA16_2397))</code></pre></div>
<p>Or a similar map with all of the trimmings:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(toronto) +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggsf">geom_sf</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">fill =</span> v_CA16_2397), <span class="dt">colour =</span> <span class="st">"grey"</span>) +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/scale_viridis">scale_fill_viridis_c</a></span>(<span class="st">"Median HH Income"</span>, <span class="dt">labels =</span> scales::dollar) +<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_minimal</a></span>() +
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/theme">theme</a></span>(<span class="dt">panel.grid =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(),
        <span class="dt">axis.text =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>(),
        <span class="dt">axis.ticks =</span> <span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/element">element_blank</a></span>()) +<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">labs</a></span>(<span class="dt">title =</span> <span class="st">"Median Household Income"</span>, <span class="dt">subtitle =</span> <span class="st">"Toronto Census Subdivisions, 2016 Census"</span>)</code></pre></div>
</div>
<div id="interactive-maps-with-leaflet" class="section level1">
<h1 class="hasAnchor">
<a href="#interactive-maps-with-leaflet" class="anchor"></a>Interactive maps with leaflet</h1>
<p>The <a href="http://leafletjs.com">leaflet</a> library is a mainstay behind interactive web maps, and RStudio has <a href="https://rstudio.github.io/leaflet/">package</a> that allows creation of interactive leaflet maps without having to leave R or use Javascript.</p>
<p>Leaflet for R can natively read in <code>sf</code> or <code>sp</code> class objects. Leaflet maps use a tile layer server to generate the base maps on which your data is plotted. There’s a number of different base layers available to use, although some require third party API keys. A gallery of available basemaps can be found <a href="http://leaflet-extras.github.io/leaflet-providers/preview/index.html">here</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(leaflet)
<span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/leaflet">leaflet</a></span>(toronto) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/addProviderTiles">addProviderTiles</a></span>(providers$CartoDB.Positron) %&gt;%
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/map-layers">addPolygons</a></span>()</code></pre></div>
<p>Adding colour ramps and additional interactivity takes a little bit more work but is still pretty easy to implement. Following this <a href="https://rstudio.github.io/leaflet/choropleths.html">example</a> we can specify the colour ramp to match our needs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bins &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">30000</span>,<span class="dv">40000</span>, <span class="dv">50000</span>,<span class="dv">60000</span>, <span class="dv">70000</span>,<span class="dv">80000</span>, <span class="dv">90000</span>,<span class="dv">100000</span>, <span class="dv">110000</span>, <span class="ot">Inf</span>)
pal &lt;-<span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/colorNumeric">colorBin</a></span>(<span class="st">"RdYlBu"</span>, <span class="dt">domain =</span> toronto$v_CA16_2397, <span class="dt">bins =</span> bins)
<span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/leaflet">leaflet</a></span>(toronto) %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/addProviderTiles">addProviderTiles</a></span>(providers$CartoDB.Positron) %&gt;%
<span class="st">  </span><span class="kw"><a href="http://www.rdocumentation.org/packages/leaflet/topics/map-layers">addPolygons</a></span>(<span class="dt">fillColor =</span> ~<span class="kw">pal</span>(v_CA16_2397),
              <span class="dt">color =</span> <span class="st">"white"</span>,
              <span class="dt">weight =</span> <span class="dv">1</span>,
              <span class="dt">opacity =</span> <span class="dv">1</span>,
              <span class="dt">fillOpacity =</span> <span class="fl">0.65</span>)</code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#spatial-data-in-cancensus">Spatial data in cancensus</a></li>
      <li><a href="#maps-with-base-r-graphics">Maps with base R graphics</a></li>
      <li><a href="#maps-with-ggplot2">Maps with ggplot2</a></li>
      <li><a href="#interactive-maps-with-leaflet">Interactive maps with leaflet</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Jens von Bergmann, Dmitry Shkolnik, Aaron Jacobs.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
